#ifndef _TEDDY_H
#define _TEDDY_H

void TeddyInit(int rows, int cols, int color, char *font_file);

void TeddyClose();

int TeddyRun();

void TeddyClear();

void TeddyAddLine(char *str);

void TeddyAddMultiLine(char *str);

char *TeddyReadLine();

#ifdef TEDDY

/************/
/* INCLUDES */
/************/
//std
#include "assert.h"
#include "stdio.h"
#include "stdlib.h"
#include "string.h"

//glfw
#define GLFW_INCLUDE_GLEXT
#include "GLFW/glfw3.h"

/***********/
/* DEFINES */
/***********/
#define UNUSED(x) (void)(x)

#define T_VERSION "TEDDY 1.0"//LOL

//opengl
#define T_OPENGL_MAJOR          4
#define T_OPENGL_MINOR          5
#define T_COLOR_LOCATION        "PixelColor"

//glyphs
#define T_DEFAULT_GLYPH_W       8
#define T_DEFAULT_GLYPH_H       8

/************/
/* TYPEDEFS */
/************/
typedef struct Teddy
{
    int rows;
    int cols;

    int cx;
    int cy;
    char *terminal;  

    int prompt_typing;
    int prompt_ready;
    
    int color;

    int texture_w;
    int texture_h;
    unsigned char *texture_buffer;

    int glyph_w;
    int glyph_h;
    unsigned char **glyphs;
    
    //glfw
    GLFWwindow *window;

    //opengl
    GLuint vao;
    GLuint vbo;
    GLuint vert_shader;
    GLuint frag_shader;
    GLuint prog_shader;
    GLuint texture;

} Teddy;

/**********/
/* STATIC */
/**********/
static Teddy *teddy = NULL;

static const float T_TEXTURE_VERTICES[16] = 
{
-1.0f, -1.0f, 0.0f, 1.0f,
-1.0f,  1.0f, 0.0f, 0.0f,
 1.0f, -1.0f, 1.0f, 1.0f,
 1.0f,  1.0f, 1.0f, 0.0f
};

static const char T_VERT_SRC[] = "\
#version 450\n\
layout (location = 0) in vec2 Pos;\n\
layout (location = 1) in vec2 Uv;\n\
out vec2 Tex;\n \
void main()\n\
{\n\
    gl_Position = vec4(Pos, 0.0f, 1.0f);\n\
    Tex = Uv;\n\
}\n";

static const char T_FRAG_SRC[] = "\
#version 450\n\
in vec2 Tex;\n\
uniform sampler2D Texture;\n\
uniform vec3 PixelColor;\n\
out vec4 final;\n\
void main()\n\
{\n\
    float val = texture(Texture, Tex).r;\n\
    vec4 f = vec4(val*PixelColor, 1.0f);\n\
\n\
    float var = sin(Tex.y*1440);\n\
    if(var<0.5f){ var = 0.5f; }\n\
\n\
	final = f*var;\n\
\n\
}\n";

static const unsigned char T_DEFAULT_FONT[2048] = 
{
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x81, 0xA5, 0x81, 0xBD, 0x99, 0x81, 0x7E, 
0x7E, 0xFF, 0xDB, 0xFF, 0xC3, 0xE7, 0xFF, 0x7E, 0x6C, 0xFE, 0xFE, 0xFE, 0x7C, 0x38, 0x10, 0x00, 
0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x38, 0x10, 0x00, 0x38, 0x7C, 0x38, 0xFE, 0xFE, 0xD6, 0x10, 0x38,
0x10, 0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x10, 0x38, 0x00, 0x00, 0x18, 0x3C, 0x3C, 0x18, 0x00, 0x00, 
0xFF, 0xFF, 0xE7, 0xC3, 0xC3, 0xE7, 0xFF, 0xFF, 0x00, 0x3C, 0x66, 0x42, 0x42, 0x66, 0x3C, 0x00, 
0xFF, 0xC3, 0x99, 0xBD, 0xBD, 0x99, 0xC3, 0xFF, 0x0F, 0x07, 0x0F, 0x7D, 0xCC, 0xCC, 0xCC, 0x78,
0x3C, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x7E, 0x18, 0x3F, 0x33, 0x3F, 0x30, 0x30, 0x70, 0xF0, 0xE0, 
0x7F, 0x63, 0x7F, 0x63, 0x63, 0x67, 0xE6, 0xC0, 0x18, 0xDB, 0x3C, 0xE7, 0xE7, 0x3C, 0xDB, 0x18, 
0x80, 0xE0, 0xF8, 0xFE, 0xF8, 0xE0, 0x80, 0x00, 0x02, 0x0E, 0x3E, 0xFE, 0x3E, 0x0E, 0x02, 0x00,
0x18, 0x3C, 0x7E, 0x18, 0x18, 0x7E, 0x3C, 0x18, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x66, 0x00,
0x7F, 0xDB, 0xDB, 0x7B, 0x1B, 0x1B, 0x1B, 0x00, 0x3E, 0x63, 0x38, 0x6C, 0x6C, 0x38, 0xCC, 0x78, 
0x00, 0x00, 0x00, 0x00, 0x7E, 0x7E, 0x7E, 0x00, 0x18, 0x3C, 0x7E, 0x18, 0x7E, 0x3C, 0x18, 0xFF,
0x18, 0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x3C, 0x18, 0x00, 
0x00, 0x18, 0x0C, 0xFE, 0x0C, 0x18, 0x00, 0x00, 0x00, 0x30, 0x60, 0xFE, 0x60, 0x30, 0x00, 0x00, 
0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xFE, 0x00, 0x00, 0x00, 0x24, 0x66, 0xFF, 0x66, 0x24, 0x00, 0x00,
0x00, 0x18, 0x3C, 0x7E, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x7E, 0x3C, 0x18, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x78, 0x78, 0x30, 0x30, 0x00, 0x30, 0x00, 
0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6C, 0x6C, 0xFE, 0x6C, 0xFE, 0x6C, 0x6C, 0x00,
0x30, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x30, 0x00, 0x00, 0xC6, 0xCC, 0x18, 0x30, 0x66, 0xC6, 0x00, 
0x38, 0x6C, 0x38, 0x76, 0xDC, 0xCC, 0x76, 0x00, 0x60, 0x60, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x18, 0x30, 0x60, 0x60, 0x60, 0x30, 0x18, 0x00, 0x60, 0x30, 0x18, 0x18, 0x18, 0x30, 0x60, 0x00,
0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00, 0x00, 0x30, 0x30, 0xFC, 0x30, 0x30, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x60, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xC0, 0x80, 0x00,
0x7C, 0xC6, 0xCE, 0xDE, 0xF6, 0xE6, 0x7C, 0x00, 0x30, 0x70, 0x30, 0x30, 0x30, 0x30, 0xFC, 0x00, 
0x78, 0xCC, 0x0C, 0x38, 0x60, 0xCC, 0xFC, 0x00, 0x78, 0xCC, 0x0C, 0x38, 0x0C, 0xCC, 0x78, 0x00, 
0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x1E, 0x00, 0xFC, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
0x38, 0x60, 0xC0, 0xF8, 0xCC, 0xCC, 0x78, 0x00, 0xFC, 0xCC, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00, 
0x78, 0xCC, 0xCC, 0x78, 0xCC, 0xCC, 0x78, 0x00, 0x78, 0xCC, 0xCC, 0x7C, 0x0C, 0x18, 0x70, 0x00, 
0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x60,
0x18, 0x30, 0x60, 0xC0, 0x60, 0x30, 0x18, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0xFC, 0x00, 0x00, 
0x60, 0x30, 0x18, 0x0C, 0x18, 0x30, 0x60, 0x00, 0x78, 0xCC, 0x0C, 0x18, 0x30, 0x00, 0x30, 0x00, 
0x7C, 0xC6, 0xDE, 0xDE, 0xDE, 0xC0, 0x78, 0x00, 0x30, 0x78, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0x00,
0xFC, 0x66, 0x66, 0x7C, 0x66, 0x66, 0xFC, 0x00, 0x3C, 0x66, 0xC0, 0xC0, 0xC0, 0x66, 0x3C, 0x00, 
0xF8, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0xF8, 0x00, 0xFE, 0x62, 0x68, 0x78, 0x68, 0x62, 0xFE, 0x00, 
0xFE, 0x62, 0x68, 0x78, 0x68, 0x60, 0xF0, 0x00, 0x3C, 0x66, 0xC0, 0xC0, 0xCE, 0x66, 0x3E, 0x00,
0xCC, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC, 0x00, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00, 
0x1E, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x78, 0x00, 0xE6, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0xE6, 0x00, 
0xF0, 0x60, 0x60, 0x60, 0x62, 0x66, 0xFE, 0x00, 0xC6, 0xEE, 0xFE, 0xFE, 0xD6, 0xC6, 0xC6, 0x00,
0xC6, 0xE6, 0xF6, 0xDE, 0xCE, 0xC6, 0xC6, 0x00, 0x38, 0x6C, 0xC6, 0xC6, 0xC6, 0x6C, 0x38, 0x00, 
0xFC, 0x66, 0x66, 0x7C, 0x60, 0x60, 0xF0, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0xDC, 0x78, 0x1C, 0x00, 
0xFC, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0xE6, 0x00, 0x78, 0xCC, 0x60, 0x30, 0x18, 0xCC, 0x78, 0x00,
0xFC, 0xB4, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xFC, 0x00, 
0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x00, 0xC6, 0xC6, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00, 
0xC6, 0xC6, 0x6C, 0x38, 0x38, 0x6C, 0xC6, 0x00, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x30, 0x78, 0x00,
0xFE, 0xC6, 0x8C, 0x18, 0x32, 0x66, 0xFE, 0x00, 0x78, 0x60, 0x60, 0x60, 0x60, 0x60, 0x78, 0x00, 
0xC0, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x02, 0x00, 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78, 0x00, 
0x10, 0x38, 0x6C, 0xC6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
0x30, 0x30, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x76, 0x00, 
0xE0, 0x60, 0x60, 0x7C, 0x66, 0x66, 0xDC, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xC0, 0xCC, 0x78, 0x00, 
0x1C, 0x0C, 0x0C, 0x7C, 0xCC, 0xCC, 0x76, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00,
0x38, 0x6C, 0x60, 0xF0, 0x60, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8, 
0xE0, 0x60, 0x6C, 0x76, 0x66, 0x66, 0xE6, 0x00, 0x30, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00, 
0x0C, 0x00, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x78, 0xE0, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0xE6, 0x00,
0x70, 0x30, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00, 0x00, 0x00, 0xCC, 0xFE, 0xFE, 0xD6, 0xC6, 0x00, 
0x00, 0x00, 0xF8, 0xCC, 0xCC, 0xCC, 0xCC, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0x78, 0x00, 
0x00, 0x00, 0xDC, 0x66, 0x66, 0x7C, 0x60, 0xF0, 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0x1E,
0x00, 0x00, 0xDC, 0x76, 0x66, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x00, 
0x10, 0x30, 0x7C, 0x30, 0x30, 0x34, 0x18, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0x76, 0x00, 
0x00, 0x00, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x00, 0x00, 0x00, 0xC6, 0xD6, 0xFE, 0xFE, 0x6C, 0x00,
0x00, 0x00, 0xC6, 0x6C, 0x38, 0x6C, 0xC6, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8, 
0x00, 0x00, 0xFC, 0x98, 0x30, 0x64, 0xFC, 0x00, 0x1C, 0x30, 0x30, 0xE0, 0x30, 0x30, 0x1C, 0x00, 
0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x00, 0xE0, 0x30, 0x30, 0x1C, 0x30, 0x30, 0xE0, 0x00,
0x76, 0xDC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x38, 0x6C, 0xC6, 0xC6, 0xFE, 0x00, 
0x78, 0xCC, 0xC0, 0xCC, 0x78, 0x18, 0x0C, 0x78, 0x00, 0xCC, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 
0x1C, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00, 0x7E, 0xC3, 0x3C, 0x06, 0x3E, 0x66, 0x3F, 0x00,
0xCC, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 0xE0, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 
0x30, 0x30, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 0x00, 0x00, 0x78, 0xC0, 0xC0, 0x78, 0x0C, 0x38, 
0x7E, 0xC3, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00, 0xCC, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00,
0xE0, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00, 0xCC, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00, 
0x7C, 0xC6, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00, 0xE0, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00, 
0xC6, 0x38, 0x6C, 0xC6, 0xFE, 0xC6, 0xC6, 0x00, 0x30, 0x30, 0x00, 0x78, 0xCC, 0xFC, 0xCC, 0x00,
0x1C, 0x00, 0xFC, 0x60, 0x78, 0x60, 0xFC, 0x00, 0x00, 0x00, 0x7F, 0x0C, 0x7F, 0xCC, 0x7F, 0x00, 
0x3E, 0x6C, 0xCC, 0xFE, 0xCC, 0xCC, 0xCE, 0x00, 0x78, 0xCC, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00,
0x00, 0xCC, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00, 0x00, 0xE0, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00, 
0x78, 0xCC, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 0x00, 0xE0, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 
0x00, 0xCC, 0x00, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8, 0xC3, 0x18, 0x3C, 0x66, 0x66, 0x3C, 0x18, 0x00, 
0xCC, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0x78, 0x00, 0x18, 0x18, 0x7E, 0xC0, 0xC0, 0x7E, 0x18, 0x18,
0x38, 0x6C, 0x64, 0xF0, 0x60, 0xE6, 0xFC, 0x00, 0xCC, 0xCC, 0x78, 0xFC, 0x30, 0xFC, 0x30, 0x30, 
0xF8, 0xCC, 0xCC, 0xFA, 0xC6, 0xCF, 0xC6, 0xC7, 0x0E, 0x1B, 0x18, 0x3C, 0x18, 0x18, 0xD8, 0x70, 
0x1C, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 0x38, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00,
0x00, 0x1C, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00, 0x00, 0x1C, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 
0x00, 0xF8, 0x00, 0xF8, 0xCC, 0xCC, 0xCC, 0x00, 0xFC, 0x00, 0xCC, 0xEC, 0xFC, 0xDC, 0xCC, 0x00, 
0x3C, 0x6C, 0x6C, 0x3E, 0x00, 0x7E, 0x00, 0x00, 0x38, 0x6C, 0x6C, 0x38, 0x00, 0x7C, 0x00, 0x00,
0x30, 0x00, 0x30, 0x60, 0xC0, 0xCC, 0x78, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xC0, 0xC0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xFC, 0x0C, 0x0C, 0x00, 0x00, 0xC3, 0xC6, 0xCC, 0xDE, 0x33, 0x66, 0xCC, 0x0F, 
0xC3, 0xC6, 0xCC, 0xDB, 0x37, 0x6F, 0xCF, 0x03, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00,
0x00, 0x33, 0x66, 0xCC, 0x66, 0x33, 0x00, 0x00, 0x00, 0xCC, 0x66, 0x33, 0x66, 0xCC, 0x00, 0x00, 
0x22, 0x88, 0x22, 0x88, 0x22, 0x88, 0x22, 0x88, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 
0xDB, 0x77, 0xDB, 0xEE, 0xDB, 0x77, 0xDB, 0xEE, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
0x18, 0x18, 0x18, 0x18, 0xF8, 0x18, 0x18, 0x18, 0x18, 0x18, 0xF8, 0x18, 0xF8, 0x18, 0x18, 0x18, 
0x36, 0x36, 0x36, 0x36, 0xF6, 0x36, 0x36, 0x36, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x36, 0x36, 0x36, 
0x00, 0x00, 0xF8, 0x18, 0xF8, 0x18, 0x18, 0x18, 0x36, 0x36, 0xF6, 0x06, 0xF6, 0x36, 0x36, 0x36,
0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x00, 0x00, 0xFE, 0x06, 0xF6, 0x36, 0x36, 0x36, 
0x36, 0x36, 0xF6, 0x06, 0xFE, 0x00, 0x00, 0x00, 0x36, 0x36, 0x36, 0x36, 0xFE, 0x00, 0x00, 0x00, 
0x18, 0x18, 0xF8, 0x18, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x18, 0x18, 0x18,
0x18, 0x18, 0x18, 0x18, 0x1F, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0xFF, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1F, 0x18, 0x18, 0x18, 
0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0xFF, 0x18, 0x18, 0x18,
0x18, 0x18, 0x1F, 0x18, 0x1F, 0x18, 0x18, 0x18, 0x36, 0x36, 0x36, 0x36, 0x37, 0x36, 0x36, 0x36, 
0x36, 0x36, 0x37, 0x30, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x30, 0x37, 0x36, 0x36, 0x36, 
0x36, 0x36, 0xF7, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xF7, 0x36, 0x36, 0x36,
0x36, 0x36, 0x37, 0x30, 0x37, 0x36, 0x36, 0x36, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 
0x36, 0x36, 0xF7, 0x00, 0xF7, 0x36, 0x36, 0x36, 0x18, 0x18, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 
0x36, 0x36, 0x36, 0x36, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x18, 0x18, 0x18,
0x00, 0x00, 0x00, 0x00, 0xFF, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x3F, 0x00, 0x00, 0x00, 
0x18, 0x18, 0x1F, 0x18, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x18, 0x1F, 0x18, 0x18, 0x18, 
0x00, 0x00, 0x00, 0x00, 0x3F, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xFF, 0x36, 0x36, 0x36,
0x18, 0x18, 0xFF, 0x18, 0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xF8, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x1F, 0x18, 0x18, 0x18, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x76, 0xDC, 0xC8, 0xDC, 0x76, 0x00, 0x00, 0x78, 0xCC, 0xF8, 0xCC, 0xF8, 0xC0, 0xC0, 
0x00, 0xFC, 0xCC, 0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0xFE, 0x6C, 0x6C, 0x6C, 0x6C, 0x6C, 0x00,
0xFC, 0xCC, 0x60, 0x30, 0x60, 0xCC, 0xFC, 0x00, 0x00, 0x00, 0x7E, 0xD8, 0xD8, 0xD8, 0x70, 0x00, 
0x00, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x60, 0xC0, 0x00, 0x76, 0xDC, 0x18, 0x18, 0x18, 0x18, 0x00, 
0xFC, 0x30, 0x78, 0xCC, 0xCC, 0x78, 0x30, 0xFC, 0x38, 0x6C, 0xC6, 0xFE, 0xC6, 0x6C, 0x38, 0x00,
0x38, 0x6C, 0xC6, 0xC6, 0x6C, 0x6C, 0xEE, 0x00, 0x1C, 0x30, 0x18, 0x7C, 0xCC, 0xCC, 0x78, 0x00, 
0x00, 0x00, 0x7E, 0xDB, 0xDB, 0x7E, 0x00, 0x00, 0x06, 0x0C, 0x7E, 0xDB, 0xDB, 0x7E, 0x60, 0xC0, 
0x38, 0x60, 0xC0, 0xF8, 0xC0, 0x60, 0x38, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0x00,
0x00, 0xFC, 0x00, 0xFC, 0x00, 0xFC, 0x00, 0x00, 0x30, 0x30, 0xFC, 0x30, 0x30, 0x00, 0xFC, 0x00, 
0x60, 0x30, 0x18, 0x30, 0x60, 0x00, 0xFC, 0x00, 0x18, 0x30, 0x60, 0x30, 0x18, 0x00, 0xFC, 0x00, 
0x0E, 0x1B, 0x1B, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xD8, 0xD8, 0x70,
0x30, 0x30, 0x00, 0xFC, 0x00, 0x30, 0x30, 0x00, 0x00, 0x76, 0xDC, 0x00, 0x76, 0xDC, 0x00, 0x00, 
0x38, 0x6C, 0x6C, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x0C, 0x0C, 0x0C, 0xEC, 0x6C, 0x3C, 0x1C,
0x78, 0x6C, 0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x70, 0x18, 0x30, 0x60, 0x78, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x3C, 0x3C, 0x3C, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

//log
static PFNGLGETPROGRAMINFOLOGPROC glGetProgramInfoLog = NULL;
static PFNGLDEBUGMESSAGECALLBACKPROC glDebugMessageCallback = NULL;

//program
static PFNGLCREATEPROGRAMPROC glCreateProgram = NULL;
static PFNGLDELETEPROGRAMPROC glDeleteProgram = NULL;
static PFNGLUSEPROGRAMPROC glUseProgram = NULL;
static PFNGLATTACHSHADERPROC glAttachShader = NULL;
static PFNGLDETACHSHADERPROC glDetachShader = NULL;
static PFNGLLINKPROGRAMPROC glLinkProgram = NULL;
static PFNGLGETPROGRAMIVPROC glGetProgramiv = NULL;
static PFNGLGETSHADERINFOLOGPROC glGetShaderInfoLog = NULL;
static PFNGLGETUNIFORMLOCATIONPROC glGetUniformLocation = NULL;
static PFNGLUNIFORM3FPROC glUniform3f = NULL;
static PFNGLENABLEVERTEXATTRIBARRAYPROC glEnableVertexAttribArray = NULL;
static PFNGLDISABLEVERTEXATTRIBARRAYPROC glDisableVertexAttribArray = NULL;
 
//shader
static PFNGLCREATESHADERPROC glCreateShader = NULL;
static PFNGLDELETESHADERPROC glDeleteShader = NULL;
static PFNGLSHADERSOURCEPROC glShaderSource = NULL;
static PFNGLCOMPILESHADERPROC glCompileShader = NULL;
static PFNGLGETSHADERIVPROC glGetShaderiv = NULL;
 
//VBO
static PFNGLGENBUFFERSPROC glGenBuffers = NULL;
static PFNGLBINDBUFFERPROC glBindBuffer = NULL;
static PFNGLBUFFERDATAPROC glBufferData = NULL;
static PFNGLVERTEXATTRIBPOINTERPROC glVertexAttribPointer = NULL;
static PFNGLDELETEBUFFERSPROC glDeleteBuffers = NULL;
static PFNGLBUFFERSUBDATAPROC glBufferSubData = NULL;
 
//VAO
static PFNGLGENVERTEXARRAYSPROC glGenVertexArrays = NULL;
static PFNGLBINDVERTEXARRAYPROC glBindVertexArray = NULL;
static PFNGLDELETEVERTEXARRAYSPROC glDeleteVertexArrays = NULL;

/**************/
/* PROTOTYPES */
/**************/
//glfw
static void TeddyGlfwResizeCallback(GLFWwindow *window, int width, int height);
static void TeddyGlfwKeyCallback(GLFWwindow *window,  int key, int scancode, int action, int mods);
static void TeddyGlfwCharCallback(GLFWwindow *window, unsigned int codepoint);
static void TeddyGlfwInit();
static void TeddyGlfwClose();

//opengl
static void TeddyOpenglLoadExtensions();
static GLuint TeddyOpenglShader(GLenum type, const char *src);
static GLuint TeddyOpenglProgramShader(GLuint vert_shader, GLuint frag_shader);
static void TeddyOpenglInit();
static void TeddyOpenglClose();

//teddy internal
static void TeddyBufferLoad(char *file, unsigned char **buffer, int *size);
static void TeddyInitGlyphs(const unsigned char *font);
static void TeddyDrawChar(char c, int row, int col);
static void TeddyRender(int copy);

/********/
/* GLFW */
/********/
static void TeddyGlfwResizeCallback(GLFWwindow *window, int width, int height)
{
    UNUSED(window);

    int x = 0;
	int y = 0;
    float view_w = 0;
    float view_h = 0;

	float ratio = (float)teddy->texture_w/(float)teddy->texture_h;

	if( width/ratio < height)
	{
		view_w = width;
		view_h = (int)(view_w/ratio);
	}
	else
	{
		view_h = height;
		view_w = (int)(view_h*ratio);
	}

	x = (width - view_w)/2;
	y = (height - view_h)/2;
		
    glViewport(x, y, view_w, view_h);	

    TeddyRender(1);

}

/**********/
static void TeddyGlfwKeyCallback(GLFWwindow *window,  int key, int scancode, int action, int mods)
{
    UNUSED(window);
    UNUSED(scancode);
    UNUSED(mods);

    if(action==GLFW_RELEASE) { return; }
    
    switch (key)
    {
        case GLFW_KEY_BACKSPACE:
            if(teddy->cx>0) 
            { 
                teddy->cx--;
                teddy->terminal[teddy->cy*teddy->cols+teddy->cx] = 0;
                TeddyRender(1);
            }      
            break;
        
        case GLFW_KEY_ENTER:
            if(teddy->prompt_typing) { teddy->prompt_ready = 1; }
            break;

        case GLFW_KEY_ESCAPE:
            glfwSetWindowShouldClose(teddy->window,1);
            break;

        default:
            break;
    }
    
}

/**********/
static void TeddyGlfwCharCallback(GLFWwindow *window, unsigned int codepoint)
{
    assert(window);

    if(codepoint < 0xFF && teddy->cx<teddy->cols-1)
    {
        teddy->terminal[ teddy->cy*teddy->cols + teddy->cx] = (char)codepoint;
        teddy->cx++;
        TeddyRender(1);
    }
}

/**********/
static void TeddyGlfwInit()
{
    assert(glfwInit());

    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, T_OPENGL_MAJOR);
    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, T_OPENGL_MINOR);
    
    glfwWindowHint(GLFW_DOUBLEBUFFER, 1);
    
    teddy->window = glfwCreateWindow(teddy->texture_w, teddy->texture_h, "", NULL, NULL);

    assert(teddy->window);

    glfwSetWindowSizeCallback(teddy->window, TeddyGlfwResizeCallback);

    glfwMakeContextCurrent(teddy->window);

    glfwSwapInterval(1);

    //
    glfwSetKeyCallback(teddy->window, TeddyGlfwKeyCallback);
    glfwSetCharCallback(teddy->window,TeddyGlfwCharCallback);
}

/**********/
static void TeddyGlfwClose()
{
    glfwDestroyWindow(teddy->window);
 
    glfwTerminate();
}

/**********/
/* OPENGL */
/**********/
static void TeddyOpenglLoadExtensions()
{
    //log
    glGetProgramInfoLog = (PFNGLGETPROGRAMINFOLOGPROC)glfwGetProcAddress("glGetProgramInfoLog");
    assert(glGetProgramInfoLog);
    glDebugMessageCallback = (PFNGLDEBUGMESSAGECALLBACKPROC)glfwGetProcAddress("glDebugMessageCallback");
    assert(glDebugMessageCallback);

    //program
    glCreateProgram = (PFNGLCREATEPROGRAMPROC)glfwGetProcAddress("glCreateProgram");
    assert(glCreateProgram);
    glDeleteProgram = (PFNGLDELETEPROGRAMPROC)glfwGetProcAddress("glDeleteProgram");
    assert(glDeleteProgram);
    glUseProgram = (PFNGLUSEPROGRAMPROC)glfwGetProcAddress("glUseProgram");
    assert(glUseProgram);
    glAttachShader = (PFNGLATTACHSHADERPROC)glfwGetProcAddress("glAttachShader");
    assert(glAttachShader);
    glDetachShader = (PFNGLDETACHSHADERPROC)glfwGetProcAddress("glDetachShader");
    assert(glDetachShader);
    glLinkProgram = (PFNGLLINKPROGRAMPROC)glfwGetProcAddress("glLinkProgram");
    assert(glLinkProgram);
    glGetProgramiv = (PFNGLGETPROGRAMIVPROC)glfwGetProcAddress("glGetProgramiv");
    assert(glGetProgramiv);
    glGetShaderInfoLog = (PFNGLGETSHADERINFOLOGPROC)glfwGetProcAddress("glGetShaderInfoLog");
    assert(glGetShaderInfoLog);
    glGetUniformLocation = (PFNGLGETUNIFORMLOCATIONPROC)glfwGetProcAddress("glGetUniformLocation");
    assert(glGetUniformLocation);
    glUniform3f = (PFNGLUNIFORM3FPROC)glfwGetProcAddress("glUniform3f");
    assert(glUniform3f);
    glEnableVertexAttribArray = (PFNGLENABLEVERTEXATTRIBARRAYPROC)glfwGetProcAddress("glEnableVertexAttribArray");
    assert(glEnableVertexAttribArray);
    glDisableVertexAttribArray = (PFNGLDISABLEVERTEXATTRIBARRAYPROC)glfwGetProcAddress("glDisableVertexAttribArray");
    assert(glDisableVertexAttribArray);

    //shader
    glCreateShader = (PFNGLCREATESHADERPROC)glfwGetProcAddress("glCreateShader");
    assert(glCreateShader);
    glDeleteShader = (PFNGLDELETESHADERPROC)glfwGetProcAddress("glDeleteShader");
    assert(glDeleteShader);
    glShaderSource = (PFNGLSHADERSOURCEPROC)glfwGetProcAddress("glShaderSource");
    assert(glShaderSource);
    glCompileShader = (PFNGLCOMPILESHADERPROC)glfwGetProcAddress("glCompileShader");
    assert(glCompileShader);
    glGetShaderiv = (PFNGLGETSHADERIVPROC)glfwGetProcAddress("glGetShaderiv");
    assert(glGetShaderiv);

    //VBO
    glGenBuffers = (PFNGLGENBUFFERSPROC)glfwGetProcAddress("glGenBuffers");
    assert(glGenBuffers);
    glBindBuffer = (PFNGLBINDBUFFERPROC)glfwGetProcAddress("glBindBuffer");
    assert(glBindBuffer);
    glBufferData = (PFNGLBUFFERDATAPROC)glfwGetProcAddress("glBufferData");
    assert(glBufferData);
    glVertexAttribPointer = (PFNGLVERTEXATTRIBPOINTERPROC)glfwGetProcAddress("glVertexAttribPointer");
    assert(glVertexAttribPointer);
    glDeleteBuffers = (PFNGLDELETEBUFFERSPROC)glfwGetProcAddress("glDeleteBuffers");
    assert(glDeleteBuffers);
    glBufferSubData = (PFNGLBUFFERSUBDATAPROC)glfwGetProcAddress("glBufferSubData");
    assert(glBufferSubData);

    //VAO
    glGenVertexArrays = (PFNGLGENVERTEXARRAYSPROC)glfwGetProcAddress("glGenVertexArrays");
    assert(glGenVertexArrays);
    glBindVertexArray = (PFNGLBINDVERTEXARRAYPROC)glfwGetProcAddress("glBindVertexArray");
    assert(glBindVertexArray);
    glDeleteVertexArrays = (PFNGLDELETEVERTEXARRAYSPROC)glfwGetProcAddress("glDeleteVertexArrays");  
    assert(glDeleteVertexArrays);
}

/**********/
static GLuint TeddyOpenglShader(GLenum type, const char *src)
{
	GLuint shader = glCreateShader(type);

	glShaderSource(shader, 1, (const GLchar**)&src, NULL);

	glCompileShader(shader);

	GLint check = GL_FALSE;

	glGetShaderiv(shader, GL_COMPILE_STATUS, &check);

	assert(check);

	return shader;
}

/**********/
static GLuint TeddyOpenglProgramShader(GLuint vert_shader, GLuint frag_shader)
{
	GLuint prog_shader = glCreateProgram();

	glAttachShader(prog_shader, vert_shader);

	glAttachShader(prog_shader, frag_shader);

	glLinkProgram(prog_shader);

	GLint check = GL_FALSE;

	glGetProgramiv(prog_shader, GL_LINK_STATUS, &check);

	assert(check);

	return prog_shader;
}

/**********/
static void TeddyOpenglInit()
{
    TeddyOpenglLoadExtensions();

    glGenVertexArrays(1, &teddy->vao);
    glBindVertexArray(teddy->vao); 

	glGenBuffers(1, &teddy->vbo);
    glBindBuffer(GL_ARRAY_BUFFER, teddy->vbo);

	glEnableVertexAttribArray(0);//vertex 
	glVertexAttribPointer(0, 2, GL_FLOAT, GL_FALSE, 4 * sizeof(float), (void*)0);
	
    glEnableVertexAttribArray(1);//texture 
	glVertexAttribPointer(1, 2, GL_FLOAT, GL_FALSE, 4 * sizeof(float), (void*)(2 * sizeof(float)) );

	glBufferData(GL_ARRAY_BUFFER, 16*sizeof(float), T_TEXTURE_VERTICES, GL_STATIC_DRAW);	
	
	glPixelStorei(GL_UNPACK_ALIGNMENT,1);//fix for w not multiple of 4

	glGenTextures(1, &teddy->texture);

	glBindTexture(GL_TEXTURE_2D, teddy->texture);

	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);	
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);

	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
	
	glTexImage2D(GL_TEXTURE_2D, 0, GL_RED, teddy->texture_w, teddy->texture_h, 0, GL_RED, GL_UNSIGNED_BYTE, NULL);

	teddy->vert_shader = TeddyOpenglShader(GL_VERTEX_SHADER, T_VERT_SRC);

    teddy->frag_shader = TeddyOpenglShader(GL_FRAGMENT_SHADER, T_FRAG_SRC);

    teddy->prog_shader = TeddyOpenglProgramShader(teddy->vert_shader, teddy->frag_shader);

	glUseProgram(teddy->prog_shader);

    unsigned char r = (unsigned char)(teddy->color >> 16);
    unsigned char g = (unsigned char)((teddy->color >> 8) & 0xFF);
    unsigned char b = (unsigned char)(teddy->color & 0xFF);

    int loc = glGetUniformLocation(teddy->prog_shader, T_COLOR_LOCATION);

    glUniform3f(loc, (float)r/0xFF, (float)g/0xFF, (float)b/0xFF );

}

/**********/
static void TeddyOpenglClose()
{
    glDeleteTextures(1, &teddy->texture);

    glDisableVertexAttribArray(0);

    glDisableVertexAttribArray(1);

    glDeleteVertexArrays(1, &teddy->vao);

    glDeleteBuffers(1, &teddy->vbo);

	glDetachShader(teddy->prog_shader, teddy->vert_shader);
	glDeleteShader(teddy->vert_shader);

	glDetachShader(teddy->prog_shader, teddy->frag_shader);
	glDeleteShader(teddy->frag_shader);

	glDeleteProgram(teddy->prog_shader);
}


/*********/
/* TEDDY */
/*********/
static void TeddyBufferLoad(char *file, unsigned char **buffer, int *size)
{
    FILE *fp = fopen(file, "rb");

	assert(fp);

	assert(fseek(fp, 0, SEEK_END)==0);

	size_t _size = ftell(fp);

	*buffer = calloc( _size, sizeof(unsigned char));

    assert(*buffer);

	assert(fseek(fp, 0, SEEK_SET)==0);

	size_t check = fread(*buffer, _size, 1, fp);

	assert(check==1);

	fclose(fp);

	*size = (int)_size;
}

/**********/
static void TeddyInitGlyphs(const unsigned char *font)
{
    teddy->glyphs = calloc(256, sizeof(unsigned char*));

    for(int count=0;count<256;count++)
    {
        teddy->glyphs[count] = calloc(teddy->glyph_w*teddy->glyph_h, sizeof(unsigned char*));
    
        int index = teddy->glyph_h * count;

        int _count=0;

        for(int32_t i=0;i<teddy->glyph_h;i++)
        {  
            uint8_t byte = font[index];
            
            //for(int32_t j=0;j<teddy->glyph_w;j++)//THIS IF YOU LIKE EVIL
            for(int32_t j=teddy->glyph_w-1;j>=0;j--)
            {
                teddy->glyphs[count][_count] = ((byte>>j) & 1)*0xFF;

                _count++;
            }

            index++;
        }
    }
}

/**********/
static void TeddyDrawChar(char c, int row, int col)
{
    unsigned char *p = teddy->texture_buffer;

    p += row * teddy->glyph_h * teddy->cols * teddy->glyph_w;
    p += col * teddy->glyph_w;

    unsigned char *g = teddy->glyphs[(unsigned char)c];

    for(int i=0;i<teddy->glyph_h;i++)
    {
        memcpy(p,g,teddy->glyph_w);

        p += teddy->cols * teddy->glyph_w;

        g += teddy->glyph_w;
    }
}

/**********/
static void TeddyRender(int copy)
{
    glClear(GL_COLOR_BUFFER_BIT);
    
    if(copy)
    {
        for(int count=0;count<teddy->rows*teddy->cols;count++)
        {
            TeddyDrawChar( teddy->terminal[count], count/teddy->cols, count%teddy->cols);
        }
    }

    glTexSubImage2D(GL_TEXTURE_2D, 0, 0, 0, teddy->texture_w, teddy->texture_h, GL_RED, GL_UNSIGNED_BYTE, teddy->texture_buffer);

	glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);

    glfwSwapBuffers(teddy->window);
}

/**********/
void TeddyInit(int rows, int cols, int color, char *font_file)
{
    teddy = calloc(1,sizeof(Teddy));
    
    assert(teddy);

    teddy->rows = rows;
    teddy->cols = cols;

    teddy->cx = 0;
    teddy->cy = rows-1;
    
    teddy->terminal = calloc(rows*cols,sizeof(char));
    assert(teddy->terminal);

    teddy->color = color;

    teddy->glyph_w = T_DEFAULT_GLYPH_W;
    teddy->glyph_h = T_DEFAULT_GLYPH_H;

    unsigned char *buffer = NULL;
    int buffer_size = 0;

    if(font_file)
    {
        TeddyBufferLoad(font_file, &buffer, &buffer_size);
        teddy->glyph_h = buffer_size/256;
    }

    teddy->texture_w = teddy->cols * teddy->glyph_w;
    teddy->texture_h = teddy->rows * teddy->glyph_h;
    teddy->texture_buffer = calloc(teddy->texture_w*teddy->texture_h,sizeof(unsigned char));
    assert(teddy->texture_buffer);

    if(buffer)
    {
        TeddyInitGlyphs(buffer);
        free(buffer);
    }
    else
    {
        TeddyInitGlyphs(T_DEFAULT_FONT);
    }

    TeddyGlfwInit();    

    TeddyOpenglInit();    

    TeddyRender(1);
}

/**********/
void TeddyClose()
{
    TeddyOpenglClose();

    TeddyGlfwClose();

    for(int count=0;count<256;count++)
    {
        free(teddy->glyphs[count]);
    }

    free(teddy->terminal);

    free(teddy->glyphs);

    free(teddy->texture_buffer);

    free(teddy);
}

/**********/
int TeddyRun()
{
    glfwPollEvents();

	return !glfwWindowShouldClose(teddy->window);
}

/**********/
void TeddyClear()
{
    memset(teddy->terminal,0x00,teddy->rows*teddy->cols);

    TeddyRender(1);
}

/**********/
void TeddyAddLine(char *str)
{
    char *p = teddy->terminal;

    for(int i=0;i<teddy->rows-2;i++)
    {
        memcpy(p,p+teddy->cols,teddy->cols);

        p += teddy->cols;
    }

    strncpy(p,str,teddy->cols);

    TeddyRender(1);
}

/**********/
void TeddyAddMultiLine(char *str)
{
    int len = strlen(str);
    char *ptr = str;

    for(int i=0;i<len/teddy->cols;i++)
    {
        TeddyAddLine(ptr);

        ptr += teddy->cols;
    }

    if(len%teddy->cols != 0) {  TeddyAddLine(ptr); }

}

/**********/
char *TeddyReadLine()
{
    teddy->prompt_typing = 1;

    char blink = 0;

    double blink_time = glfwGetTime();

    while(1)
    {
        glfwPollEvents();

        if(glfwWindowShouldClose(teddy->window)) { break; }

        if(teddy->prompt_ready)
        {
            char *str = calloc(teddy->cols+1,sizeof(char));

            strncpy(str,&teddy->terminal[(teddy->rows-1)*teddy->cols],teddy->cols);
           
            memset(&teddy->terminal[(teddy->rows-1)*teddy->cols],0x00,teddy->cols);

            teddy->prompt_ready=0;

            teddy->cx = 0;

            TeddyRender(1);

            teddy->prompt_typing = 0;

            return str;
        }

        //blink
        if( glfwGetTime() - blink_time > 0.350)
        {
            blink = (blink==0) ? 0xDB : 0;

            TeddyDrawChar(blink,teddy->cy,teddy->cx);
            
            TeddyRender(0);

            blink_time = glfwGetTime();
        }
    }

    teddy->prompt_typing = 0;

    return NULL;
}

#endif

#endif